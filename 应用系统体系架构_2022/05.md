# `WebSocket`

- 在我们的`bookstore`没有使用`websocket`之前，我们的请求以及响应一定是需要**`client`进行激发的**。而`websocket`则希望实现的是`server`也能够主动的实现向客户端的消息的推送/接收。因为如果需要用户主动的去拉取数据的话，很难控制拉取数据的频率。
- `websocket`是一个**应用层**协议，在`TCP`协议层之上。主要是解决`HTTP`中只有接收到请求才能响应的问题，即主动进行响应，实现`full-duplex`(双端)。
- `TCP`短连接的问题：每次连接之后通信结束之后就会释放，这样每次连接都会重新三次握手，性能不好。
- `websocket`是建立在**`TCP`通信机制的长链接**基础上的。提高了数据的实时性。
- `websocket`实现之后，`client`与`server`之间有一次变成**等价**关系了，即实现了`peer-to-peer`的特性，即建立连接的两端是对称的（**`full-duplex`**）。
- 为何不使用定时器来每过固定时间就去后端拉取数据？因为**固定计时器的的固定时间不好选择**。
- `websocket`的核心是实现在后端的`endpoint`,其可以同时连接多个`client`（可以进行**广播**，即上课讲的那个聊天室的例子，而且一般是前端把信息发送到`endpoint`,再由`endpoint`转发到前端实现广播。），而一个`client`一般只能连接一个`endpoint`。
- `websocket protocol`的两个阶段：`handshake+transfer`。
- `handshake`实际上就是实现前端与后端`websocket endpoint`的连接。需要发送一个`HTTP connection upgrade request`(是一个`HTTP`协议)。使用`sec-websocket-key(client)`与`sec-websocket-accept(server)`来判断是否成功。
- 两种`WebSocket`模式：`ws,wss`。
- `OnMessage`注解注释的方法是用于处理监听到的消息的，这个注解可以被使用多次，但是每个被注解的方法要保证处理的消息类型不一样。
- `webSocket`后端需要保证存储`sessions`的数据结构是**线程安全的**，可以使用`ConcurrentHashMap`等数据结构。